From f6e9717ef334f930623cd6bc24942a3a6e4cc266 Mon Sep 17 00:00:00 2001
From: 12101111 <w12101111@gmail.com>
Date: Fri, 6 Feb 2026 11:40:22 +0800
Subject: [PATCH 05/11] Build without electron

---
 build/gulpfile.vscode.ts | 10 ++++++++--
 build/npm/preinstall.ts  |  3 +++
 2 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/build/gulpfile.vscode.ts b/build/gulpfile.vscode.ts
index 358bb3acad3..9466400faf1 100644
--- a/build/gulpfile.vscode.ts
+++ b/build/gulpfile.vscode.ts
@@ -11,7 +11,6 @@ import vfs from 'vinyl-fs';
 import rename from 'gulp-rename';
 import replace from 'gulp-replace';
 import filter from 'gulp-filter';
-import electron from '@vscode/gulp-electron';
 import jsonEditor from 'gulp-json-editor';
 import * as util from './lib/util.ts';
 import { getVersion } from './lib/getVersion.ts';
@@ -213,6 +212,13 @@ function computeChecksum(filename: string): string {
 	return hash;
 }
 
+function moveApp() {
+	var appPath = "resources/app";
+	return rename(function (path) {
+		path.dirname = appPath + (path.dirname === "." ? "" : "/" + path.dirname);
+	});
+}
+
 function packageTask(platform: string, arch: string, sourceFolderName: string, destinationFolderName: string, _opts?: { stats?: boolean }) {
 	const destination = path.join(path.dirname(root), destinationFolderName);
 	platform = platform || process.platform;
@@ -374,7 +380,7 @@ function packageTask(platform: string, arch: string, sourceFolderName: string, d
 			.pipe(util.skipDirectories())
 			.pipe(util.fixWin32DirectoryPermissions())
 			.pipe(filter(['**', '!**/.github/**'], { dot: true })) // https://github.com/microsoft/vscode/issues/116523
-			.pipe(electron({ ...config, platform, arch: arch === 'armhf' ? 'arm' : arch, ffmpegChromium: false }))
+			.pipe(moveApp())
 			.pipe(filter(['**', '!LICENSE', '!version'], { dot: true }));
 
 		if (platform === 'linux') {
diff --git a/build/npm/preinstall.ts b/build/npm/preinstall.ts
index 3476fcabb50..2d4555f5244 100644
--- a/build/npm/preinstall.ts
+++ b/build/npm/preinstall.ts
@@ -97,6 +97,9 @@ function hasSupportedVisualStudioVersion() {
 }
 
 function installHeaders() {
+	if (process.env['ELECTRON_SKIP_BINARY_DOWNLOAD']) {
+		return;
+	}
 	const npm = process.platform === 'win32' ? 'npm.cmd' : 'npm';
 	child_process.execSync(`${npm} ${process.env.npm_command || 'ci'}`, {
 		env: process.env,
-- 
2.53.0

