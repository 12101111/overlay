diff --git a/nsswitch/wscript_build b/nsswitch/wscript_build
index 3247b6c..4d70750 100644
--- a/nsswitch/wscript_build
+++ b/nsswitch/wscript_build
@@ -28,8 +28,9 @@ bld.SAMBA_PLUGIN('nss_wrapper_winbind',
 
 # FIXME: original was *linux* | gnu* | k*bsd*-gnu | kopensolaris*-gnu)
 # the search for .rfind('gnu') covers gnu* and *-gnu is that too broad?
-
-if (Utils.unversioned_sys_platform() == 'linux' or (host_os.rfind('gnu') > -1)):
+if True:
+    pass
+elif (Utils.unversioned_sys_platform() == 'linux' or (host_os.rfind('gnu') > -1)):
     bld.SAMBA_PLUGIN('nss_winbind',
               keep_underscore=True,
               cflags='-D_PUBLIC_ON_LINUX_=_PUBLIC_',
diff --git a/lib/util/access.c b/lib/util/access.c
index b1b4bff..f4b5ae7 100644
--- a/lib/util/access.c
+++ b/lib/util/access.c
@@ -115,7 +115,7 @@ static bool string_match(const char *tok,const char *s)
 			return true;
 		}
 	} else if (tok[0] == '@') { /* netgroup: look it up */
-#ifdef HAVE_NETGROUP
+#if defined(HAVE_NETGROUP) && defined(HAVE_INNETGR)
 		DATA_BLOB tmp;
 		char *mydomain = NULL;
 		char *hostname = NULL;
diff --git a/source3/auth/user_util.c b/source3/auth/user_util.c
index f40123e..95c0f55 100644
--- a/source3/auth/user_util.c
+++ b/source3/auth/user_util.c
@@ -135,7 +135,7 @@ static void store_map_in_gencache(TALLOC_CTX *ctx, const char *from, const char
 
 bool user_in_netgroup(TALLOC_CTX *ctx, const char *user, const char *ngname)
 {
-#ifdef HAVE_NETGROUP
+#if defined(HAVE_NETGROUP) && defined(HAVE_INNETGR)
 	char nis_domain_buf[256];
 	const char *nis_domain = NULL;
 	char *lowercase_user = NULL;
