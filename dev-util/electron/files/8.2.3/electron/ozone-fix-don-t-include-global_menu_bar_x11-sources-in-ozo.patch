From 052c972cb4cd74ee4d8018f26e6649c7dcdd8d3f Mon Sep 17 00:00:00 2001
From: Daniel Playfair Cal <daniel.playfair.cal@gmail.com>
Date: Mon, 25 Nov 2019 10:18:23 +1100
Subject: [PATCH 2/7] fix: don't include global_menu_bar_x11 sources in ozone
 builds

---
 filenames.gni | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/filenames.gni b/filenames.gni
index 0d23c2bad..49863eb4e 100644
--- a/filenames.gni
+++ b/filenames.gni
@@ -1,3 +1,5 @@
+import("//build/config/ui.gni")
+
 filenames = {
   default_app_ts_sources = [
     "default_app/default_app.ts",
@@ -25,8 +27,6 @@ filenames = {
     "chromium_src/chrome/browser/process_singleton.h",
     "chromium_src/chrome/browser/process_singleton_posix.cc",
     "chromium_src/chrome/browser/process_singleton_win.cc",
-    "chromium_src/chrome/browser/ui/views/frame/global_menu_bar_registrar_x11.cc",
-    "chromium_src/chrome/browser/ui/views/frame/global_menu_bar_registrar_x11.h",
     "shell/app/electron_content_client.cc",
     "shell/app/electron_content_client.h",
     "shell/app/electron_main_delegate.cc",
@@ -371,8 +371,6 @@ filenames = {
     "shell/browser/ui/views/autofill_popup_view.h",
     "shell/browser/ui/views/frameless_view.cc",
     "shell/browser/ui/views/frameless_view.h",
-    "shell/browser/ui/views/global_menu_bar_x11.cc",
-    "shell/browser/ui/views/global_menu_bar_x11.h",
     "shell/browser/ui/views/inspectable_web_contents_view_views.cc",
     "shell/browser/ui/views/inspectable_web_contents_view_views.h",
     "shell/browser/ui/views/menu_bar.cc",
@@ -600,6 +598,15 @@ filenames = {
     "shell/utility/electron_content_utility_client.h",
   ]
 
+  if (is_linux && !use_ozone) {
+    lib_sources += [
+      "chromium_src/chrome/browser/ui/views/frame/global_menu_bar_registrar_x11.cc",
+      "chromium_src/chrome/browser/ui/views/frame/global_menu_bar_registrar_x11.h",
+      "shell/browser/ui/views/global_menu_bar_x11.cc",
+      "shell/browser/ui/views/global_menu_bar_x11.h",
+    ]
+  }
+
   lib_sources_nss = [
     "chromium_src/chrome/browser/certificate_manager_model.cc",
     "chromium_src/chrome/browser/certificate_manager_model.h",
-- 
2.26.1

