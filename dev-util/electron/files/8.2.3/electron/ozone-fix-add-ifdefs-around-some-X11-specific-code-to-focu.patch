From 5c70a2690a04e417767c54b728644353968eb2b7 Mon Sep 17 00:00:00 2001
From: Daniel Playfair Cal <daniel.playfair.cal@gmail.com>
Date: Mon, 25 Nov 2019 13:46:20 +1100
Subject: [PATCH 7/7] fix: add ifdefs around some X11 specific code to focus
 dialogs

---
 shell/browser/ui/file_dialog_gtk.cc | 4 ++++
 shell/browser/ui/message_box_gtk.cc | 5 +++++
 2 files changed, 9 insertions(+)

diff --git a/shell/browser/ui/file_dialog_gtk.cc b/shell/browser/ui/file_dialog_gtk.cc
index d7991a2a8..9755d7bcb 100644
--- a/shell/browser/ui/file_dialog_gtk.cc
+++ b/shell/browser/ui/file_dialog_gtk.cc
@@ -15,7 +15,9 @@
 #include "shell/browser/unresponsive_suppressor.h"
 #include "shell/common/gin_converters/file_path_converter.h"
 #include "ui/base/glib/glib_signal.h"
+#if !defined(USE_OZONE)
 #include "ui/views/widget/desktop_aura/x11_desktop_handler.h"
+#endif
 
 namespace file_dialog {
 
@@ -134,10 +136,12 @@ class FileChooserDialog {
                      this);
     gtk_widget_show_all(dialog_);
 
+    #if !defined(USE_OZONE)
     // We need to call gtk_window_present after making the widgets visible to
     // make sure window gets correctly raised and gets focus.
     int time = ui::X11EventSource::GetInstance()->GetTimestamp();
     gtk_window_present_with_time(GTK_WINDOW(dialog_), time);
+    #endif
   }
 
   void RunSaveAsynchronous(
diff --git a/shell/browser/ui/message_box_gtk.cc b/shell/browser/ui/message_box_gtk.cc
index e5ec1bfc6..1414244ac 100644
--- a/shell/browser/ui/message_box_gtk.cc
+++ b/shell/browser/ui/message_box_gtk.cc
@@ -15,7 +15,9 @@
 #include "shell/browser/unresponsive_suppressor.h"
 #include "ui/base/glib/glib_signal.h"
 #include "ui/gfx/image/image_skia.h"
+#if !defined(USE_OZONE)
 #include "ui/views/widget/desktop_aura/x11_desktop_handler.h"
+#endif
 
 #define ANSI_FOREGROUND_RED "\x1b[31m"
 #define ANSI_FOREGROUND_BLACK "\x1b[30m"
@@ -133,10 +135,13 @@ class GtkMessageBox : public NativeWindowObserver {
 
   void Show() {
     gtk_widget_show(dialog_);
+
+    #if !defined(USE_OZONE)
     // We need to call gtk_window_present after making the widgets visible to
     // make sure window gets correctly raised and gets focus.
     int time = ui::X11EventSource::GetInstance()->GetTimestamp();
     gtk_window_present_with_time(GTK_WINDOW(dialog_), time);
+    #endif
   }
 
   int RunSynchronous() {
-- 
2.26.1

